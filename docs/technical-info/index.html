<!DOCTYPE html>
<html lang="en">

    <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Technical Information | Smart PreOp Docs</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Technical Information" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Solution Overview" />
<meta property="og:description" content="Solution Overview" />
<link rel="canonical" href="https://solutions.aireinnovate.com/smart-preop-doc/docs/technical-info/" />
<meta property="og:url" content="https://solutions.aireinnovate.com/smart-preop-doc/docs/technical-info/" />
<meta property="og:site_name" content="Smart PreOp Docs" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-10-14T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Technical Information" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-10-14T00:00:00+00:00","datePublished":"2024-10-14T00:00:00+00:00","description":"Solution Overview","headline":"Technical Information","mainEntityOfPage":{"@type":"WebPage","@id":"https://solutions.aireinnovate.com/smart-preop-doc/docs/technical-info/"},"url":"https://solutions.aireinnovate.com/smart-preop-doc/docs/technical-info/"}</script>
<!-- End Jekyll SEO tag -->

  <meta property="og:image" content="https://solutions.aireinnovate.com/smart-preop-doc/assets/posts/"/>
  <link rel="stylesheet" href="/smart-preop-doc/assets/css/main.css" | relative_url }}">
  <link rel="shortcut icon" type="image/png" href="/smart-preop-doc/assets/img/favicon.png" | relative_url }}" >
  <link rel="alternate" type="application/rss+xml" title="Smart PreOp Docs" href="/smart-preop-doc/feed.xml" | relative_url }}">
  <script src="/smart-preop-doc/assets/js/main.js" | relative_url }}"></script>
  
</head>

    <body>
    <!-- 
<nav class="siblings dark">
	
	<div class="nav-bar wrapper wrapper-large">
		
		<span class="no-active-replacement"></span>
	</div>
</nav> -->
    <header class="uk-background-secondary">
    <div data-uk-sticky="sel-target: .uk-navbar-container; cls-active: uk-navbar-sticky" class="uk-sticky uk-sticky-fixed" style="position: fixed; top: 0px; width: 1904px;">
        <nav class="uk-navbar-container">
            <div class="uk-container">
    <div data-uk-navbar>
        <div class="uk-navbar-left">
            <a class="uk-navbar-item uk-logo uk-visible@m" href="/smart-preop-doc/">Smart PreOp Docs</a>
            
              <a class="uk-navbar-toggle uk-hidden@m" href="#offcanvas-docs" data-uk-navbar-toggle-icon data-uk-toggle></a>
            

        </div>
        <div class="uk-navbar-center uk-hidden@m">
            <a class="uk-navbar-item uk-logo" href="/smart-preop-doc/">Smart PreOp Docs</a>
        </div>
        <div class="uk-navbar-right">
            <ul class="uk-navbar-nav uk-visible@m">
                
                    
                    
                    
                        <li><a href="/smart-preop-doc/docs/introduction" >Introduction</a></li>
                    
                
                    
                    
                    
                        <li><a href="/smart-preop-doc/docs/technical-info" >Technical Info</a></li>
                    
                
                    
                    
                    
                        <li><a href="/smart-preop-doc/changelog/" >Changelog</a></li>
                    
                
                    
                    
                    
                        <li><a href="https://www.aireinnovate.com/" target="_blank" >About AireInnovate</a></li>
                    
                
            </ul>

            <!-- 
            <div>
                <a class="uk-navbar-toggle" uk-search-icon href="#"></a>
                <div class="uk-drop uk-background-default uk-border-rounded" uk-drop="mode: click; pos: left-center; offset: 0">
                    <form class="uk-search uk-search-navbar uk-width-1-1" onsubmit="return false;">
                        <input id="navbar-search" class="uk-search-input" type="search" placeholder="Search..." autofocus>
                    </form>
                    <ul id="navbar-search-results" class="uk-position-absolute uk-width-1-1 uk-list"></ul>
                </div>
            </div>
            <script>
            SimpleJekyllSearch({
                searchInput: document.getElementById('navbar-search'),
                resultsContainer: document.getElementById('navbar-search-results'),
                noResultsText: '<li>No results found</li>',
                searchResultTemplate: '<li><a href="{url}">{title}</a></li>',
                json: '/smart-preop-doc/search.json'
            });
            </script>
             -->

            
              <a class="uk-navbar-toggle uk-hidden@m" href="#offcanvas" data-uk-navbar-toggle-icon data-uk-toggle></a>
            


        </div>
    </div>
</div>

        </nav>
    </div>
</header>


    

    <div class="uk-section">
    <div class="uk-container">
        <div class="uk-grid-large" data-uk-grid>

            <div class="sidebar-fixed-width uk-visible@m">
                <div class="sidebar-docs uk-position-fixed">
                    
                    <h5>Introduction</h5>
                    <ul class="uk-nav uk-nav-default doc-nav">
                    
                      
                      
                      <li class=""><a href="/smart-preop-doc/docs/introduction/">Introduction to Smart PreOp</a></li>
                    
                    </ul>
                    
                    <h5>Technical Information</h5>
                    <ul class="uk-nav uk-nav-default doc-nav">
                    
                      
                      
                      <li class="uk-active"><a href="/smart-preop-doc/docs/technical-info/">Technical Information</a></li>
                    
                    </ul>
                    
                </div>
            </div>

            <div class="uk-width-1-1 uk-width-expand@m">

                <article class="uk-article">

                    <h1 class="uk-article-title">Technical Information</h1>

                    

                    <div class="uk-article-meta uk-margin-top uk-margin-medium-bottom">
                        





<time datetime="2024-10-14T00:00:00+00:00" itemprop="datePublished">
    
    Oct 14, 2024
</time>

                    </div>

                    <div class="article-content">
                        <h2 id="solution-overview">Solution Overview</h2>

<p>The Smart PreOp Model is a modelling pipeline that contains several ‘preprocessing’ steps followed by a machine learning model which makes a prediction on the processed data.</p>

<p>The model will take ‘raw data’ as input and will output a dictionary of ‘asa_score’ probabilities and warnings (if applicable). The probabilities will be presented as floating point numbers which represent the probabilities of each class.</p>

<p>There are two components to the Machine Learning Model. The output of these components are used alongside other data to produce an American Society of Anesthesiologists (ASA) physical status classification system reference score which is presented to the clinician.
Header: Mortality Risk Prediction Model</p>

<p>A mortality risk prediction model that yields a probability of death 30 days after surgery (class 0 = no mortality and class 1 = mortality). It serves to allow comparison of the methods used by Aire Logic and Aire Innovate with previous work. Risk of mortality at 30 days &gt;5% is used as national bodies suggest high-risk patients should be defined for planned admission to critical care.</p>

<h2 id="asa-classification-model">ASA Classification Model</h2>

<p>A model for classifying patients’ ASA scores as either ASA 1-2 (class 0) or ASA 3-5 (class 1). The purpose of this model is to identify a lower-risk cohort from electronic records, as mandated in the NHS England Standard Contract [Ref 2].
Both models take account only of fields currently available via GP Connect as structured items, and both perform well. In particular, the ASA stratification model can reliably identify around 40% of true lower-risk patients with &gt;95% precision.</p>

<h2 id="data-preparation-and-initial-processing">Data Preparation and Initial Processing</h2>

<p>The primary focus of phase one of solution development was to refine the data into a minimal, yet effective input format. Each data entry, representing a surgical procedure, comprised variables including Age, Sex, ImdDecile, a list of medications, Admission Method, and Procedure. Individuals under 20 years of age and those listed under ‘ventilation support’ procedures were excluded. Data consolidation was achieved by joining datasets on patient IDs, with surgical episodes identified within the admission and discharge timeframe.</p>

<h2 id="smart-preop-pipelinel-an-innovative-data-processing-framework">Smart PreOp PipelineL An Innovative Data Processing Framework</h2>

<p>The custom pipeline (SmartPreOpPipeline) built for phase one of the solution, houses all data processing and modelling code. This pipeline incorporates a unique Warner class designed to manage and aggregate warnings that can be presented to end users. This feature is particularly useful in flagging data that deviates from the training dataset’s ranges or observed values. The pipeline includes capabilities for fitting, transforming, and predicting probabilities as well as schema validation which ensures compatibility with the expected data format.</p>

<h2 id="handling-medication-data---medication-tuner-class">Handling Medication Data - Medication Tuner Class</h2>

<p>The first step in the pipeline, this class is responsible for encoding medication data and dynamically selecting the optimal aggregation methods for the embedding encoder. The Embedding Encoder Class is a sophisticated transformer which utilises theBioBERT model – a variant of the BERT model pre-trained on biomedical texts – to generate embeddings from medication data. These embeddings are then used as features in the machine-learning models.</p>

<ul>
  <li>BioBERT Model: BioBERT’s pre-training on biomedical texts makes it effective for modelling biomedical terminology (i.e. medications).</li>
  <li>MedicationManager Class: Manages the caching of medication embeddings, computational efficiency by minimising repeated calculations. It also supports integration with Amazon S3 for embedding storage.</li>
  <li>MedicationEmbeddings Class: Generates embeddings for a list of medications and offers various strategies for aggregating these embeddings.</li>
  <li>Tuning Experiment: An integral part of the EmbeddingEncoder , this experiment evaluates various aggregation methods for medication embeddings to identify the most effective technique for dataset-specific tasks.</li>
</ul>

<h2 id="feature-engineering-and-extraction">Feature Engineering and Extraction</h2>

<p>The pipeline uses a single transformer for feature engineering:</p>

<ul>
  <li>EncodeEmergency: Processes the admission method column to determine if the admission was an emergency or not.</li>
  <li>CategoricalEncoder: Processes the categorical variables (Sex, procedure and admission method) to give one hot encoded columns.</li>
  <li>AgeEncoder: Processes age band to give integers in the age column</li>
  <li>ClusterEncoder (GMM Encoder): Implements clustering algorithms, such asGaussian Mixture Models, for data stratification based on specified columns (i.e. demographics).</li>
</ul>

<h2 id="feature-selection">Feature Selection</h2>

<p>The XGBoostFeatureSelector class has been chosen as the tool for feature selection. It identifies and selects key features from the dataset by fitting a machine learning model and examining the internals of the model to determine the important features. This allows continual improvement of model performance and interpretability. This process is governed by a set of parameters and a threshold for feature importance.</p>

<h2 id="final-model">Final Model</h2>

<p>The XGBoostTunePredict class in this module is used to determine the optimal hyperparameters and train the final XGBoost model. This class is designed not only to predict outcomes but also to fine-tune the model’s hyperparameters using Optuna, a hyperparameter optimisation framework.</p>

<p>The class determines the optimal value for the following parameters:</p>

<h1 id="hyperparameter-space-param_distributions">Hyperparameter Space (param_distributions)</h1>

<p>Defines the search space for hyperparameters of the XGBoost model, including n_estimators, max_depth, learning_rate, subsample, min_child_weight, and use_scale_pos_weight. 
These parameters are essential in determining the performance of the XGBoost model and are optimised during the tuning process.</p>

<h1 id="optuna-integration">Optuna Integration</h1>

<p>The class uses Optuna to conduct trials, aiming to identify the best combination of parameters within the defined space.
Optuna’s study object is created to manage these trials.</p>

<h1 id="evaluator">Evaluator</h1>

<p>A metric or a set of metrics (like F1 score, ROC AUC, log loss, etc.) are used to evaluate the performance of the models during the hyperparameter tuning process.</p>

<h1 id="other-configurations">Other Configurations</h1>

<p>n_trials: Specifies the number of trials for hyperparameter optimisation.
show_progress_bar: A boolean to indicate whether to show the progress of
optimisation trials.
n_jobs: Determines the number of parallel jobs to run for XGBoost training.
frac: The fraction of data used for tuning, with the remaining used for validation.</p>

<h1 id="fitting">Fitting</h1>

<p>Data Splitting: The dataset is split into tuning and validation sets, with the frac parameter determining the proportion.
Scale Pos Weight Calculation: get_pos_weight calculates the ratio of the minority to majority class in the target variable, which is a critical factor for handling class imbalance in XGBoost.
Objective Function for Optuna: objective_xgb defines the objective for Optuna’s study, which involves training an XGBoost model with trial parameters and evaluating its performance on the validation set.
Hyperparameter Optimization: Optuna conducts trials to find the best hyperparameters based on the specified evaluator.
Final Model Training: After finding the best parameters, the final XGBoost model is trained on the entire dataset.</p>

<h2 id="third-party-components">Third party components</h2>

<p>The Smart PreOp Machine Learning Model uses several third-party components:
| Component | Use |
| ——– | ——– | 
| AWS S3 | Model and metadata storage |
| AWS SageMaker | Used to train the model |
| Sklearn | API used for algorithm implementations |
| XGBoost | API used for algorithm implementations |
| Hugging face | Library for embedding generation with BioBert |
| Pandas/numpy | Numerical computing/dataframe libraries |
| AireInsights | Module running model |</p>

<h2 id="interfaces">Interfaces</h2>

<p>The Smart PreOp Machine Learning Model Interfaces with AWS Sagemaker, S3 and AireInsights.</p>

<h2 id="hosting-arrangements-and-data-storage">Hosting arrangements and data storage</h2>

<p>Data gathered via the Smart PreOp Machine Learning Model is securely hosted in Amazon’s London data centre using AWS Sagemaker for Cloud storage and AWS S3 for storage of model objects. The database is encrypted and replicated across multiple availability zones  Access to the database is restricted via IP restrictions and login details. Encrypted backups are taken nightly and stored within the same London data centre for a specified period.</p>

<h2 id="hosting-arrangements-and-data-storage-on-premises-deployments">Hosting arrangements and data storage: on-premises deployments</h2>

<p>The organisation deploying Smart PreOp is responsible for hosting arrangements for any data gathered via the solution.</p>

                        <!-- <div class="share uk-text-center">
    <a href="https://twitter.com/intent/tweet?text=Technical Information&url=https://solutions.aireinnovate.com/docs/technical-info/&via=&related=" rel="nofollow" target="_blank" title="Share on Twitter" onclick="window.open(this.href, 'twitter', 'width=550,height=235');return false;"><span data-uk-icon="icon: twitter; ratio: 1.2"></span></a>
    <a  class="uk-margin-small-left" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fsolutions.aireinnovate.com%2Fdocs%2Ftechnical-info%2F" rel="nofollow" target="_blank" title="Share on Facebook" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;"><span data-uk-icon="icon: facebook; ratio: 1.2"></span></a>
</div>
 -->
                    </div>

                    <hr class="uk-margin-medium">

                    


  
  

  
  
    <ul class="uk-pagination uk-margin-top">
          
            
            
            <li><a class="hvr-back" href="/smart-preop-doc/docs/introduction/">&larr; Previous</a></li>
          
          

          
    </ul>
    


                    <!-- <div class="uk-margin-large-top">
    <h3>Related Articles</h3>

    
    
    

    <ul class="uk-list">
    

    
    

    

    

    

    
    

    

    

    
    </ul>
</div>
 -->

                    
                </article>

                <div>
                    <div class="uk-section uk-text-center uk-link-muted">
    <div class="uk-margin-medium uk-text-small">
        <div></div>
        <div></div> 
    </div> 
</div>

                </div>

                <script>
                    // Table of contents scroll to
                    UIkit.scroll('#markdown-toc a', {
                        duration: 400,
                        offset: 120
                    });
                </script>

            </div>

    </div>
</div>


    <div id="offcanvas-docs" data-uk-offcanvas="overlay: true">
    <div class="uk-offcanvas-bar">

        <button class="uk-offcanvas-close" type="button" data-uk-close></button>

        
        <h5 class="uk-margin-top">Introduction</h5>
        <ul class="uk-nav uk-nav-default doc-nav">
        
          
          
          <li class=""><a href="/smart-preop-doc/docs/introduction/">Introduction to Smart PreOp</a></li>
        
        </ul>
        
        <h5 class="uk-margin-top">Technical Information</h5>
        <ul class="uk-nav uk-nav-default doc-nav">
        
          
          
          <li class="uk-active"><a href="/smart-preop-doc/docs/technical-info/">Technical Information</a></li>
        
        </ul>
        

    </div>
</div>


    <div id="offcanvas" data-uk-offcanvas="flip: true; overlay: true">
    <div class="uk-offcanvas-bar">

        <button class="uk-offcanvas-close" type="button" data-uk-close></button>

        <ul class="uk-nav uk-nav-default">
            <li><a class="uk-logo uk-margin-small-bottom" href="/smart-preop-doc/">Smart PreOp Docs</a></li>
            
                
            <li><a href="https://solutions.aireinnovate.com/smart-preop-doc/docs/introduction" >Introduction</a></li>
            
                
            <li><a href="https://solutions.aireinnovate.com/smart-preop-doc/docs/technical-info" >Technical Info</a></li>
            
                
            <li><a href="https://solutions.aireinnovate.com/smart-preop-doc/changelog/" >Changelog</a></li>
            
                
            <li><a href="/smart-preop-dochttps://www.aireinnovate.com/" target="_blank" >About AireInnovate</a></li>
            
        </ul>

        <div class="uk-margin-small-top uk-text-center uk-text-muted uk-link-muted">
            <div data-uk-grid class="uk-child-width-auto uk-grid-small uk-flex-center uk-grid">
                













            </div>
        </div>

    </div>
</div>


    

    </body>

</html>
